<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”µè·¯æ°´æµç±»æ¯”æ¨¡å‹</title>
    
    <!-- 1. å¼•å…¥ Tailwind CSS (æ ·å¼åº“) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. å¼•å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- 3. å¼•å…¥ Babel (è®©æµè§ˆå™¨èƒ½çœ‹æ‡‚ JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { margin: 0; font-family: sans-serif; background-color: #f8fafc; }
    </style>
</head>
<body>

    <!-- React æŒ‚è½½ç‚¹ -->
    <div id="root"></div>

    <!-- React ä»£ç åŒºåŸŸ -->
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ç®€å•çš„ SVG å›¾æ ‡ç»„ä»¶ (æ›¿ä»£ Lucide åº“) ---
        const IconZap = ({className}) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
        );
        const IconActivity = ({className, size}) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
        );
        const IconMousePointer2 = ({size, className}) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m12 6-4-4-4 4"/><path d="M8 2v8"/><path d="m16 6 4-4 4 4"/><path d="M20 2v8"/><path d="m12 18-4 4-4-4"/><path d="M8 22v-8"/><path d="m16 18 4 4 4-4"/><path d="M20 22v-8"/><path d="M4 14h16"/></svg> // Actually replaced with a simple slider icon-ish look or generic pointer
        );
        // Correct MousePointer2 path
        const IconPointer = ({size, className}) => (
             <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M4.037 4.688a.495.495 0 0 1 .651-.651l16 6.5a.5.5 0 0 1-.063.947l-6.124 1.58a2 2 0 0 0-1.438 1.435l-1.579 6.126a.5.5 0 0 1-.947.063z"/></svg>
        );
        const IconInfo = ({size, className}) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
        );

        // --- ä¸»ç»„ä»¶ ---
        const WaterPumpBattery = () => {
            const canvasRef = useRef(null);
            
            // State
            const [isSystemOn, setIsSystemOn] = useState(false); // Master switch (Tap Open/Close)
            const [tapOpening, setTapOpening] = useState(0.5); // 0 to 1 (Slider)

            // System Constants
            const EMF = 1.50; // Volts (Pa)
            const INTERNAL_R_FACTOR = 0.5; // Factor to calculate internal drop
            
            // Physics State
            const [currentI, setCurrentI] = useState(0);
            const [internalDrop, setInternalDrop] = useState(0);
            const [terminalVoltage, setTerminalVoltage] = useState(1.50);

            // Animation Refs
            const particlesRef = useRef([]);
            const animationFrameRef = useRef(null);
            const impellerAngleRef = useRef(0);
            
            // Initialize Particles
            useEffect(() => {
                const particles = [];
                const particleCount = 150;
                
                for (let i = 0; i < particleCount; i++) {
                particles.push({
                    x: Math.random() * 800, 
                    y: (Math.random() - 0.5) * 26, // Spread within pipe
                    speedOffset: 0.8 + Math.random() * 0.4, // Speed variation
                    size: 2 + Math.random() * 2
                });
                }
                particlesRef.current = particles;
            }, []);

            // Physics Loop
            useEffect(() => {
                let I = 0;
                let Ir = 0;
                let U = EMF;

                if (isSystemOn) {
                const maxPossibleCurrent = 0.6; // Arbitrary scale for visualization
                I = tapOpening * maxPossibleCurrent;
                
                Ir = I * INTERNAL_R_FACTOR;
                U = EMF - Ir;
                }

                setCurrentI(I);
                setInternalDrop(Ir);
                setTerminalVoltage(U);

            }, [isSystemOn, tapOpening]);

            // Canvas Drawing
            const draw = (ctx, width, height) => {
                // Clear
                ctx.clearRect(0, 0, width, height);

                const centerY = height / 2;
                const pipeHeight = 60;
                const pipeY = centerY - pipeHeight/2;
                
                // Background Pipe
                const gradient = ctx.createLinearGradient(0, 0, width, 0);
                gradient.addColorStop(0, '#eff6ff'); 
                gradient.addColorStop(1, '#eff6ff'); 
                
                ctx.fillStyle = gradient;
                ctx.fillRect(0, pipeY, width, pipeHeight);
                
                // Pipe Borders
                ctx.strokeStyle = '#cbd5e1';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(0, pipeY);
                ctx.lineTo(width, pipeY);
                ctx.moveTo(0, pipeY + pipeHeight);
                ctx.lineTo(width, pipeY + pipeHeight);
                ctx.stroke();

                // --- Components Positions ---
                const pumpX = 120;
                const resX = 320;
                const tapX = 550;

                // 1. Draw Particles (Water Flow)
                ctx.save();
                ctx.beginPath();
                ctx.rect(0, pipeY, width, pipeHeight);
                ctx.clip();

                const flowSpeed = currentI * 15; // Animation speed factor

                particlesRef.current.forEach(p => {
                    if (isSystemOn) {
                        p.x += flowSpeed * p.speedOffset;
                    } else {
                        p.x += Math.sin(Date.now() / 500) * 0.2;
                    }

                    if (p.x > width) p.x = -10;
                    
                    let color = '#2563eb'; // Default Blue
                    if (p.x > resX) {
                        const dropRatio = internalDrop / 0.5; // Normalize
                        const opacity = 1.0 - dropRatio * 0.8; 
                        color = `rgba(37, 99, 235, ${Math.max(0.2, opacity)})`;
                    }

                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.arc(p.x, centerY + p.y, p.size, 0, Math.PI*2);
                    ctx.fill();
                });
                ctx.restore();


                // 2. Draw Pump (Impeller)
                ctx.save();
                ctx.translate(pumpX, centerY);
                
                ctx.beginPath();
                ctx.arc(0, 0, 45, 0, Math.PI*2);
                ctx.fillStyle = '#ffffff';
                ctx.fill();
                ctx.lineWidth = 3;
                ctx.strokeStyle = '#e2e8f0';
                ctx.stroke();
                
                ctx.shadowColor = 'rgba(0,0,0,0.1)';
                ctx.shadowBlur = 10;
                
                if (isSystemOn) impellerAngleRef.current += 0.15; 
                else impellerAngleRef.current += 0.02; 
                
                ctx.rotate(impellerAngleRef.current);
                
                ctx.fillStyle = '#94a3b8';
                for(let i=0; i<6; i++) {
                    ctx.beginPath();
                    ctx.ellipse(0, -20, 8, 20, 0, 0, Math.PI*2);
                    ctx.fill();
                    ctx.rotate(Math.PI/3);
                }
                ctx.beginPath();
                ctx.arc(0, 0, 10, 0, Math.PI*2);
                ctx.fillStyle = '#475569';
                ctx.fill();
                
                ctx.restore();
                
                ctx.fillStyle = '#475569';
                ctx.font = 'bold 12px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText("æ³µ (E)", pumpX, centerY + 65);


                // 3. Draw Internal Resistance (Rusty Filter)
                ctx.save();
                ctx.translate(resX, centerY);
                
                ctx.beginPath();
                ctx.arc(0, 0, 40, 0, Math.PI*2);
                ctx.fillStyle = '#fff7ed'; 
                ctx.fill();
                ctx.lineWidth = 3;
                ctx.strokeStyle = '#fdba74'; 
                ctx.stroke();

                ctx.beginPath();
                ctx.arc(0, 0, 35, 0, Math.PI*2);
                ctx.clip();
                
                ctx.strokeStyle = '#9a3412'; 
                ctx.lineWidth = 2;
                const step = 8;
                for(let i=-40; i<40; i+=step) {
                    ctx.beginPath(); ctx.moveTo(i, -40); ctx.lineTo(i, 40); ctx.stroke();
                    ctx.beginPath(); ctx.moveTo(-40, i); ctx.lineTo(40, i); ctx.stroke();
                }
                
                ctx.fillStyle = 'rgba(124, 45, 18, 0.4)';
                for(let i=0; i<5; i++) {
                    ctx.beginPath();
                    ctx.arc((Math.random()-0.5)*40, (Math.random()-0.5)*40, Math.random()*8, 0, Math.PI*2);
                    ctx.fill();
                }

                ctx.restore();

                ctx.fillStyle = '#7c2d12';
                ctx.font = 'bold 12px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText("å†…é˜» (r)", resX, centerY + 65);


                // 4. Draw Tap (Load)
                ctx.save();
                ctx.translate(tapX, centerY - 20);
                
                ctx.fillStyle = '#d97706'; 
                ctx.fillRect(-10, 0, 20, 30);
                
                ctx.beginPath();
                ctx.moveTo(-10, 0);
                ctx.quadraticCurveTo(-10, -20, 20, -25);
                ctx.lineTo(30, -20);
                ctx.lineTo(30, -10);
                ctx.lineTo(20, -15);
                ctx.quadraticCurveTo(10, -10, 10, 0);
                ctx.fill();

                ctx.fillStyle = '#b45309';
                ctx.save();
                ctx.translate(0, -25);
                ctx.beginPath();
                ctx.moveTo(-15, -5);
                ctx.lineTo(15, -5);
                ctx.lineTo(15, 5);
                ctx.lineTo(-15, 5);
                ctx.fill();
                ctx.fillRect(-5, 0, 10, 15); 
                ctx.restore();

                ctx.restore();

                ctx.fillStyle = '#475569';
                ctx.font = 'bold 12px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText("ç”¨æˆ·æ°´ç®¡", tapX, centerY + 65);


                // 5. Draw Gauges
                const drawGauge = (x, val, label) => {
                    const gy = centerY - 80;
                    
                    ctx.strokeStyle = '#94a3b8';
                    ctx.setLineDash([4, 4]);
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(x, gy + 20);
                    ctx.lineTo(x, centerY - 20);
                    ctx.stroke();
                    ctx.setLineDash([]);

                    ctx.beginPath();
                    ctx.arc(x, gy, 22, 0, Math.PI*2);
                    ctx.fillStyle = 'white';
                    ctx.fill();
                    ctx.strokeStyle = '#cbd5e1';
                    ctx.lineWidth = 2;
                    ctx.stroke();

                    const angle = Math.PI * (0.8 + (val/2.0)); 
                    const nx = x + Math.cos(angle) * 16;
                    const ny = gy + Math.sin(angle) * 16;
                    
                    ctx.strokeStyle = '#2563eb';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(x, gy);
                    ctx.lineTo(nx, ny);
                    ctx.stroke();

                    ctx.fillStyle = '#334155';
                    ctx.font = '10px sans-serif';
                    ctx.fillText(val.toFixed(2), x, gy - 28);
                    
                    ctx.fillStyle = '#94a3b8';
                    ctx.font = '10px sans-serif';
                    ctx.fillText(label, x, gy + 35);
                };

                drawGauge(resX - 60, EMF, "å†…éƒ¨å‹åŠ›");
                drawGauge(resX + 60, terminalVoltage, "è¾“å‡ºå‹åŠ›");

            };

            // Animation Loop
            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                
                const render = () => {
                    draw(ctx, canvas.width, canvas.height);
                    animationFrameRef.current = requestAnimationFrame(render);
                };
                render();
                
                return () => cancelAnimationFrame(animationFrameRef.current);
            });

            return (
                <div className="flex flex-col w-full h-screen bg-slate-50 font-sans text-slate-800">
                
                {/* Header */}
                <div className="flex items-center justify-between px-6 py-4 bg-white border-b border-slate-200 shrink-0">
                    <div className="flex items-center gap-3">
                    <div className="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center text-white shadow-lg shadow-blue-200">
                        <IconZap className="w-6 h-6" />
                    </div>
                    <div>
                        <h1 className="text-xl font-bold text-slate-900 leading-tight">ç”µè·¯æ°´æµç±»æ¯”æ¨¡å‹</h1>
                        <p className="text-sm text-slate-500">ç”µåŠ¨åŠ¿ (E) vs è·¯ç«¯ç”µå‹ (U)</p>
                    </div>
                    </div>
                    <div className="px-3 py-1 bg-blue-50 text-blue-600 text-xs font-bold rounded-full border border-blue-100 flex items-center gap-1">
                        <IconActivity size={12} className="inline"/> äº’åŠ¨æ¼”ç¤º
                    </div>
                </div>

                {/* Main Content Grid */}
                <div className="flex flex-col lg:flex-row flex-1 p-6 gap-6 overflow-hidden">
                    
                    {/* Left: Visualization */}
                    <div className="flex-1 flex flex-col gap-4 min-w-[300px] h-full overflow-hidden">
                        
                        {/* Canvas Container */}
                        <div className="relative bg-white rounded-2xl border border-slate-200 shadow-sm flex-1 flex flex-col overflow-hidden min-h-0">
                            
                            {/* Legend */}
                            <div className="absolute top-4 left-4 bg-white/90 backdrop-blur px-3 py-2 rounded-lg border border-slate-100 shadow-sm z-10">
                                <div className="text-xs text-slate-500 mb-1 font-medium">é¢œè‰²ä»£è¡¨æ°´å‹ (ç”µåŠ¿)</div>
                                <div className="w-32 h-2 rounded-full bg-gradient-to-r from-blue-600 to-blue-100"></div>
                                <div className="flex justify-between text-[10px] text-slate-400 mt-1">
                                    <span>é«˜</span>
                                    <span>ä½</span>
                                </div>
                            </div>

                            <div className="flex-1 w-full min-h-0 relative">
                                <canvas 
                                    ref={canvasRef}
                                    width={800}
                                    height={400}
                                    className="w-full h-full object-contain absolute inset-0"
                                />
                            </div>

                            {/* Dark Stats Footer */}
                            <div className="bg-slate-900 text-white p-6 shrink-0 z-20">
                                <div className="flex items-center justify-center gap-2 md:gap-8 flex-wrap">
                                    
                                    <div className="text-center">
                                        <div className="text-xs text-slate-400 mb-1">æ€»ç”µåŠ¨åŠ¿</div>
                                        <div className="text-2xl md:text-3xl font-serif text-yellow-400 font-bold">
                                            ğ“” = {EMF.toFixed(2)} <span className="text-base font-sans text-slate-500">V</span>
                                        </div>
                                    </div>

                                    <div className="text-slate-600 text-2xl font-bold">-</div>

                                    <div className="text-center">
                                        <div className="text-xs text-slate-400 mb-1">å†…é˜»æŸè€—</div>
                                        <div className="text-2xl md:text-3xl font-serif text-red-400 font-bold">
                                            <span className="italic">Ir</span> = {internalDrop.toFixed(2)} <span className="text-base font-sans text-slate-500">V</span>
                                        </div>
                                    </div>

                                    <div className="text-slate-600 text-2xl font-bold">=</div>

                                    <div className="bg-slate-800 rounded-xl px-6 py-2 border border-slate-700 text-center">
                                        <div className="text-xs text-green-400 mb-1 font-bold tracking-wider uppercase">è·¯ç«¯ç”µå‹</div>
                                        <div className="text-3xl md:text-4xl font-serif text-green-400 font-bold">
                                            <span className="italic">U</span> = {terminalVoltage.toFixed(2)} <span className="text-base font-sans text-green-800">V</span>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>

                    </div>

                    {/* Right: Controls & Info */}
                    <div className="w-full lg:w-80 flex flex-col gap-4 shrink-0 overflow-y-auto">
                        
                        {/* Control Panel */}
                        <div className="bg-white rounded-2xl border border-slate-200 p-5 shadow-sm shrink-0">
                            <div className="flex items-center justify-between mb-6">
                                <h3 className="font-bold text-slate-800 flex items-center gap-2">
                                    <IconPointer size={18} className="text-blue-500"/>
                                    æ°´é¾™å¤´å¼€åº¦
                                </h3>
                                <button 
                                    onClick={() => setIsSystemOn(!isSystemOn)}
                                    className={`px-4 py-1.5 rounded-full text-xs font-bold transition-all ${
                                        isSystemOn 
                                        ? 'bg-blue-100 text-blue-700 hover:bg-blue-200' 
                                        : 'bg-slate-100 text-slate-500 hover:bg-slate-200'
                                    }`}
                                >
                                    {isSystemOn ? 'å·²æ‰“å¼€' : 'å·²å…³é—­'}
                                </button>
                            </div>

                            <div className="mb-2 flex justify-between text-xs text-slate-500 font-medium">
                                <span>æ–­è·¯ (I=0)</span>
                                <span>æœ€å¤§ç”µæµ</span>
                            </div>
                            
                            <input 
                                type="range"
                                min="0"
                                max="1"
                                step="0.01"
                                value={tapOpening}
                                onChange={(e) => {
                                    setTapOpening(parseFloat(e.target.value));
                                    if (!isSystemOn && parseFloat(e.target.value) > 0) setIsSystemOn(true);
                                }}
                                className="w-full h-3 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-600 mb-6"
                            />

                            <p className="text-xs text-slate-400 text-center">
                                æç¤ºï¼šæ‹–åŠ¨æ»‘å—æ¨¡æ‹Ÿæ”¹å˜è´Ÿè½½ç”µé˜»ï¼ˆæ°´ç®¡ç²—ç»†ï¼‰
                            </p>
                        </div>

                        {/* Explanation Card */}
                        <div className="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden flex-1 shrink-0">
                            <div className="bg-blue-50/50 px-5 py-3 border-b border-blue-100">
                                <h3 className="font-bold text-blue-900 flex items-center gap-2">
                                    <IconInfo size={18} className="text-blue-500"/>
                                    {isSystemOn ? "æ°´é¾™å¤´æ‰“å¼€ (é€šè·¯)" : "æ°´é¾™å¤´å…³é—­ (æ–­è·¯)"}
                                </h3>
                            </div>
                            
                            <div className="p-5 text-sm text-slate-600 space-y-4">
                                
                                {isSystemOn ? (
                                    <React.Fragment>
                                        <p>
                                            æ°´æµå†²è¿‡ç”Ÿé”ˆæ»¤ç½‘ï¼ˆå†…é˜»ï¼‰ï¼Œäº§ç”Ÿé˜»åŠ›å‹é™ã€‚
                                        </p>
                                        <p className="text-red-500 font-bold text-lg">
                                            {internalDrop.toFixed(2)}V çš„å‹åŠ›è¢«å†…é˜»æ¶ˆè€—æ‰äº†ã€‚
                                        </p>
                                        
                                        <div className="bg-slate-50 p-3 rounded-lg border border-slate-200 font-mono text-center text-slate-700">
                                            U = {EMF} - {internalDrop.toFixed(2)} = <span className="text-green-600 font-bold">{terminalVoltage.toFixed(2)} V</span>
                                        </div>

                                        <p className="italic text-slate-400 text-xs mt-2 border-l-2 border-slate-200 pl-3">
                                            â€œæ°´æµè¶Šå¿«ï¼Œè¢«å†…éƒ¨æ»¤ç½‘ï¼ˆå†…é˜»ï¼‰â€˜æˆªç•™â€™çš„å‹åŠ›å°±è¶Šå¤šã€‚â€
                                        </p>
                                    </React.Fragment>
                                ) : (
                                    <React.Fragment>
                                        <p>
                                            æ°´ä¸æµåŠ¨ï¼Œæ»¤ç½‘ä¸¤ç«¯æ²¡æœ‰å‹åŠ›å·®ã€‚
                                        </p>
                                        <p className="text-slate-500 font-medium">
                                            æ­¤æ—¶å¤–éƒ¨å‡ºå£æµ‹å¾—çš„æ°´å‹ï¼Œå®Œå…¨ç­‰äºå¶è½®äº§ç”Ÿçš„å‹åŠ›ã€‚
                                        </p>

                                        <div className="bg-slate-50 p-3 rounded-lg border border-slate-200 font-mono text-center text-slate-700">
                                            U = E = {EMF.toFixed(2)} V
                                        </div>
                                    </React.Fragment>
                                )}

                            </div>
                        </div>

                    </div>

                </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<WaterPumpBattery />);
    </script>
</body>
</html>