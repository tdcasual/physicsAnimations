# Ops Library Incident Runbook

适用范围：资源库（文件夹、资源、Embed 平台）相关线上故障与误操作。

## 1. 常见事件类型

1. 资源误删（软删除）
2. 资源被 Permanent Delete（不可恢复）
3. Embed 平台脚本失效，演示无法打开
4. 文件夹切换后列表显示异常（前端状态类问题）

## 2. 处理流程

1. 先确认服务健康：

```bash
curl -sf http://127.0.0.1:4173/api/health
```

2. 获取现象与范围：
- 影响的是单个资源还是整类资源
- 是否仅某个 Embed 平台受影响
- 是否仅管理端受影响

3. 按事件类型执行处置。

## 3. 资源误删（可恢复）

若仅执行了软删除（`DELETE /api/library/assets/:id`）：

1. 在管理页“已删除资源（可恢复）”中点“恢复”
2. 或调用恢复接口：`POST /api/library/assets/:id/restore`
3. 验证资源可再次打开

## 4. Permanent Delete（不可恢复）

`DELETE /api/library/assets/:id/permanent` 为 Permanent Delete，不可恢复。

处置策略：
1. 从外部备份恢复原始文件（推荐）
2. 无备份时，要求内容提供方重新上传
3. 记录事故，标注“数据不可逆丢失”

## 5. Embed 平台故障

表现：资源为演示模式但页面打不开，或 Embed 脚本 404。

排查：
1. 检查平台配置脚本 URL、同步状态
2. 尝试手动同步平台
3. 验证 `viewerPath` 与脚本是否同版本可访问

临时缓解：
1. 将受影响资源切换为“仅下载”
2. 确认学生端可访问原文件，保障课堂不中断

## 6. 恢复与验证清单

恢复后必须验证：
1. 资源列表可见
2. 打开模式符合预期（演示/下载）
3. 删除列表状态正确
4. 管理页无新的控制台错误

## 7. 事故复盘建议

复盘记录包含：
- 时间线
- 触发操作
- 影响范围
- 临时处置
- 根因
- 长期修复项（测试/文档/权限策略）
